{% extends "admin/layout/layout.html" %}

{% block head %}
    <link href="//cdn.bootcss.com/summernote/0.8.2/summernote.css" rel="stylesheet">
    <script src="//cdn.bootcss.com/summernote/0.8.2/summernote.min.js"></script>
{% endblock %}

{% block navbar %}
    <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse">
            <ul class="nav" id="side-menu">
                <li class="sidebar-search">
                    <div class="input-group custom-search-form">
                        <input type="text" class="form-control" placeholder="搜索...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                    </div>
                    <!-- /input-group -->
                </li>
                <li>
                    <a href="/admin/write-post"><i class="fa fa-edit fa-fw"></i> 写文章<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#tag" style="outline: 0"> 添加标签</a>
                        </li>
                    </ul>
                    <!-- /.nav-second-level -->
                </li>
                <li>
                    <a href="#" data-toggle="modal" data-target="#publish" style="outline: 0"><i
                            class="fa fa-rocket fa-fw"></i> 发布</a>
                </li>
                <li>
                    <a href="/admin"><i class="fa fa-arrow-left fa-fw"></i> 返回</a>
                </li>
            </ul>
        </div>
        <!-- /.sidebar-collapse -->
    </div>
{% endblock %}

{% block content %}
    <div class="modal fade" id="publish" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">发布文章</h4>
                </div>
                <div class="modal-body">确定要发布这篇文章吗?</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <a href="javascript:post()" type="button" class="btn btn-info">确定</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="tag" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">添加标签</h4>
                </div>
                <div class="modal-body">
                    {% for tag in tags %}
                        <code>{{ tag.name }}</code>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <a href="/admin/addTag" type="button" class="btn btn-info">确定</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12 floating-label-form-group">
            <i class="fa fa-link fa-fw"></i><input id="title" type="text" placeholder="标题"
                                                   style="width: 90%;padding-left: 10px">
        </div>
    </div>
    <div id="summernote"><p>写下一些内容...</p></div>
    <script>
        $(document).ready(function () {
            $('#summernote').summernote({
                height: document.body.clientHeight + 30,
            });
        });

        tags = [];

        {% for tag in tags %}
            var x = {};
            x.id = "{{ tag.id }}";
            x.name = "{{ tag.name}}";
            tags.push(x);
        {% endfor %}

        function post() {
            var data = {
                'title': $("#title").val(),
                'author': "pc",
                'content': $("#summernote").summernote("code"),
                'tags': tags,
            };
            $.ajax({
                type: 'POST',
                url: '/admin/write-post',
                dataType: "json",
                data: JSON.stringify(data),
                success: function (result) {
                    window.location.href = "/admin"
                }
            })
        }

    </script>
{% endblock %}